<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Where does probably fit in? • probably</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Where does probably fit in?">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">probably</a>
        <div class="info">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/equivocal-zones.html">Equivocal zones</a>
    </li>
    <li>
      <a href="../articles/where-to-use.html">Where does probably fit in?</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/probably">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Where does probably fit in?</h1>
                        <h4 class="author">Davis Vaughan</h4>
            
            <h4 class="date">2019-03-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/probably/blob/master/vignettes/where-to-use.Rmd"><code>vignettes/where-to-use.Rmd</code></a></small>
      <div class="hidden name"><code>where-to-use.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>An obvious question regarding probably might be: where does this fit in with the rest of the tidymodels ecosystem? Like the other pieces of the ecosystem, probably is designed to be modular, but plays well with other tidymodels packages.</p>
<p>Regarding placement in the modeling workflow, probably best fits in as a post processing step <em>after</em> the model has been fit, but <em>before</em> the model performance has been calculated.</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>As an example, we’ll use parsnip to fit a logistic regression on some <a href="https://www.lendingclub.com/info/download-data.action">Lending Club</a> loan data, and then use probably to investigate what happens to performance when you vary the threshold of what a “good” loan is.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(parsnip)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(probably)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(rsample)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"lending_club"</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co"># I think it makes more sense to have "good" as the first level</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co"># By default it comes as the second level</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">lending_club &lt;-<span class="st"> </span>lending_club <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Class =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/relevel">relevel</a></span>(Class, <span class="st">"good"</span>))</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"># There are a number of columns in this data set, but we will only use a few</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co"># for this example</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">lending_club &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(lending_club, Class, annual_inc, verification_status, sub_grade)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1-16" data-line-number="16">lending_club</a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt; # A tibble: 9,857 x 4</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt;    Class annual_inc verification_status sub_grade</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt;    &lt;fct&gt;      &lt;dbl&gt; &lt;fct&gt;               &lt;fct&gt;    </span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#&gt;  1 good       35000 Not_Verified        C4       </span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#&gt;  2 good       72000 Verified            C1       </span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt;  3 good       72000 Source_Verified     D1       </span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#&gt;  4 good      101000 Verified            C3       </span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">#&gt;  5 good       50100 Source_Verified     A4       </span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt;  6 good       32000 Source_Verified     B5       </span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">#&gt;  7 good       65000 Not_Verified        A1       </span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">#&gt;  8 good      188000 Not_Verified        B2       </span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">#&gt;  9 good       89000 Source_Verified     B3       </span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="co">#&gt; 10 good       48000 Not_Verified        C2       </span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="co">#&gt; # … with 9,847 more rows</span></a></code></pre></div>
<p>Let’s split this into 70% training and 30% testing for something to predict on.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># 70% train, 30% test</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">split &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rsample/topics/initial_split">initial_split</a></span>(lending_club, <span class="dt">prop =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">lending_train &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rsample/topics/initial_split">training</a></span>(split)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">lending_test  &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rsample/topics/initial_split">testing</a></span>(split)</a></code></pre></div>
<p>Before we do anything, let’s look at the counts of what we are going to be predicting, the <code>Class</code> of the loan.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(lending_train, Class)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;   Class     n</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;   &lt;fct&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; 1 good   6534</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; 2 bad     366</span></a></code></pre></div>
<p>Clearly there is a large imbalance here with the number of good and bad loans. This is probably a good thing for the bank, but poses an interesting issue for us because we might want to ensure we are sensitive to the bad loans and are not overwhelmed by the number of good ones. One thing that we might do is <em>downsample</em> the number of good loans so that the total number of them is more in line with the number of bad loans. We could do this before fitting the model using <code>recipes::step_downsample()</code>, but for now, let’s continue with the data unchanged.</p>
<p>We’ll use parsnip’s <code><a href="https://www.rdocumentation.org/packages/parsnip/topics/logistic_reg">logistic_reg()</a></code> to create a model specification for logistic regression, set the engine to be <code>glm</code> and then actually fit the model using our data and the model formula.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">logi_reg &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/parsnip/topics/logistic_reg">logistic_reg</a></span>()</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">logi_reg_glm &lt;-<span class="st"> </span>logi_reg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/parsnip/topics/set_engine">set_engine</a></span>(<span class="st">"glm"</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co"># A small model specification that defines the type of model you are </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co"># using and the engine</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">logi_reg_glm</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; Computational engine: glm</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co"># Fit the model</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">logi_reg_fit &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/parsnip/topics/reexports">fit</a></span>(</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">  logi_reg_glm, </a>
<a class="sourceLine" id="cb4-14" data-line-number="14">  <span class="dt">formula =</span> Class <span class="op">~</span><span class="st"> </span>annual_inc <span class="op">+</span><span class="st"> </span>verification_status <span class="op">+</span><span class="st"> </span>sub_grade, </a>
<a class="sourceLine" id="cb4-15" data-line-number="15">  <span class="dt">data =</span> lending_train</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">)</a>
<a class="sourceLine" id="cb4-17" data-line-number="17"></a>
<a class="sourceLine" id="cb4-18" data-line-number="18">logi_reg_fit</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; parsnip model object</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; Call:  stats::glm(formula = formula, family = stats::binomial, data = data)</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt;                        (Intercept)                          annual_inc  </span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt;                         -5.492e+00                           9.060e-07  </span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt; verification_statusSource_Verified         verification_statusVerified  </span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt;                          6.738e-02                           3.052e-01  </span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt;                        sub_gradeA2                         sub_gradeA3  </span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">#&gt;                          1.634e-01                           1.443e+00  </span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#&gt;                        sub_gradeA4                         sub_gradeA5  </span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#&gt;                         -7.757e-02                           6.025e-01  </span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="co">#&gt;                        sub_gradeB1                         sub_gradeB2  </span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="co">#&gt;                          1.184e+00                           1.253e+00  </span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="co">#&gt;                        sub_gradeB3                         sub_gradeB4  </span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="co">#&gt;                          1.956e+00                           2.077e+00  </span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="co">#&gt;                        sub_gradeB5                         sub_gradeC1  </span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="co">#&gt;                          1.676e+00                           2.313e+00  </span></a>
<a class="sourceLine" id="cb4-39" data-line-number="39"><span class="co">#&gt;                        sub_gradeC2                         sub_gradeC3  </span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"><span class="co">#&gt;                          2.333e+00                           2.050e+00  </span></a>
<a class="sourceLine" id="cb4-41" data-line-number="41"><span class="co">#&gt;                        sub_gradeC4                         sub_gradeC5  </span></a>
<a class="sourceLine" id="cb4-42" data-line-number="42"><span class="co">#&gt;                          2.617e+00                           3.033e+00  </span></a>
<a class="sourceLine" id="cb4-43" data-line-number="43"><span class="co">#&gt;                        sub_gradeD1                         sub_gradeD2  </span></a>
<a class="sourceLine" id="cb4-44" data-line-number="44"><span class="co">#&gt;                          3.012e+00                           2.788e+00  </span></a>
<a class="sourceLine" id="cb4-45" data-line-number="45"><span class="co">#&gt;                        sub_gradeD3                         sub_gradeD4  </span></a>
<a class="sourceLine" id="cb4-46" data-line-number="46"><span class="co">#&gt;                          3.134e+00                           2.949e+00  </span></a>
<a class="sourceLine" id="cb4-47" data-line-number="47"><span class="co">#&gt;                        sub_gradeD5                         sub_gradeE1  </span></a>
<a class="sourceLine" id="cb4-48" data-line-number="48"><span class="co">#&gt;                          3.256e+00                           3.439e+00  </span></a>
<a class="sourceLine" id="cb4-49" data-line-number="49"><span class="co">#&gt;                        sub_gradeE2                         sub_gradeE3  </span></a>
<a class="sourceLine" id="cb4-50" data-line-number="50"><span class="co">#&gt;                          3.085e+00                           3.569e+00  </span></a>
<a class="sourceLine" id="cb4-51" data-line-number="51"><span class="co">#&gt;                        sub_gradeE4                         sub_gradeE5  </span></a>
<a class="sourceLine" id="cb4-52" data-line-number="52"><span class="co">#&gt;                          3.310e+00                           3.685e+00  </span></a>
<a class="sourceLine" id="cb4-53" data-line-number="53"><span class="co">#&gt;                        sub_gradeF1                         sub_gradeF2  </span></a>
<a class="sourceLine" id="cb4-54" data-line-number="54"><span class="co">#&gt;                          3.576e+00                           3.576e+00  </span></a>
<a class="sourceLine" id="cb4-55" data-line-number="55"><span class="co">#&gt;                        sub_gradeF3                         sub_gradeF4  </span></a>
<a class="sourceLine" id="cb4-56" data-line-number="56"><span class="co">#&gt;                          3.390e+00                           4.371e+00  </span></a>
<a class="sourceLine" id="cb4-57" data-line-number="57"><span class="co">#&gt;                        sub_gradeF5                         sub_gradeG1  </span></a>
<a class="sourceLine" id="cb4-58" data-line-number="58"><span class="co">#&gt;                          3.618e+00                           4.639e+00  </span></a>
<a class="sourceLine" id="cb4-59" data-line-number="59"><span class="co">#&gt;                        sub_gradeG2                         sub_gradeG3  </span></a>
<a class="sourceLine" id="cb4-60" data-line-number="60"><span class="co">#&gt;                          4.000e+00                           3.839e+00  </span></a>
<a class="sourceLine" id="cb4-61" data-line-number="61"><span class="co">#&gt;                        sub_gradeG4                         sub_gradeG5  </span></a>
<a class="sourceLine" id="cb4-62" data-line-number="62"><span class="co">#&gt;                          5.663e+00                          -8.380e+00  </span></a>
<a class="sourceLine" id="cb4-63" data-line-number="63"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-64" data-line-number="64"><span class="co">#&gt; Degrees of Freedom: 6899 Total (i.e. Null);  6862 Residual</span></a>
<a class="sourceLine" id="cb4-65" data-line-number="65"><span class="co">#&gt; Null Deviance:       2862 </span></a>
<a class="sourceLine" id="cb4-66" data-line-number="66"><span class="co">#&gt; Residual Deviance: 2558  AIC: 2634</span></a></code></pre></div>
<p>The output of the parsnip <code><a href="https://www.rdocumentation.org/packages/parsnip/topics/reexports">fit()</a></code> call is a parsnip <code>model_fit</code> object, but the underlying print method for the <code>glm</code> fit is used.</p>
<p>Now let’s predict on our testing set, and use <code>type = "prob"</code> to get <em>class probabilities</em> back rather than hard predictions. We will use these with probably to investigate performance.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">predictions &lt;-<span class="st"> </span>logi_reg_fit <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(<span class="dt">new_data =</span> lending_test, <span class="dt">type =</span> <span class="st">"prob"</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(predictions, <span class="dt">n =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;   .pred_good .pred_bad</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;        &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; 1      0.996   0.00425</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; 2      0.996   0.00435</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">lending_test_pred &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(predictions, lending_test)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"></a>
<a class="sourceLine" id="cb5-13" data-line-number="13">lending_test_pred</a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; # A tibble: 2,957 x 6</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt;    .pred_good .pred_bad Class annual_inc verification_status sub_grade</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt; &lt;fct&gt;               &lt;fct&gt;    </span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt;  1      0.996   0.00425 good       50100 Source_Verified     A4       </span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt;  2      0.996   0.00435 good       65000 Not_Verified        A1       </span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt;  3      0.957   0.0425  good       48000 Not_Verified        C2       </span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt;  4      0.966   0.0343  good       40000 Source_Verified     C3       </span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt;  5      0.921   0.0790  good       26000 Not_Verified        D1       </span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt;  6      0.940   0.0600  good       62000 Source_Verified     C4       </span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt;  7      0.965   0.0345  good       92000 Not_Verified        B4       </span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt;  8      0.941   0.0589  good       40000 Source_Verified     C4       </span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt;  9      0.965   0.0352  good       70000 Source_Verified     C3       </span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt; 10      0.943   0.0565  good       65000 Verified            C1       </span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt; # … with 2,947 more rows</span></a></code></pre></div>
<p>With our class probabilities in hand, we can use <code><a href="../reference/make_class_pred.html">make_two_class_pred()</a></code> to convert these probabilities into hard predictions using a threshold. A threshold of <code>0.5</code> just says that if the predicted probability is above <code>0.5</code>, then classify this prediction as a “good” loan, otherwise, bad.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">hard_pred_<span class="fl">0.5</span> &lt;-<span class="st"> </span>lending_test_pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">.pred =</span> <span class="kw"><a href="../reference/make_class_pred.html">make_two_class_pred</a></span>(.pred_good, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(Class), <span class="dt">threshold =</span> <span class="fl">.5</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Class, <span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">".pred"</span>))</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">hard_pred_<span class="fl">0.5</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(<span class="dt">.truth =</span> Class, .pred)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;   .truth      .pred     n</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;   &lt;fct&gt;  &lt;clss_prd&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; 1 good         good  2804</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; 2 good          bad     2</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; 3 bad          good   151</span></a></code></pre></div>
<p>Hmm, with a <code>0.5</code> threshold, all loans were predicted as “good”. Perhaps this has something to do with the large class imbalance. On the other hand, the bank might want to be more stringent with what is classified as a “good” loan, and might require a probability of <code>0.75</code> as the threshold.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">hard_pred_<span class="fl">0.75</span> &lt;-<span class="st"> </span>lending_test_pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">.pred =</span> <span class="kw"><a href="../reference/make_class_pred.html">make_two_class_pred</a></span>(.pred_good, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(Class), <span class="dt">threshold =</span> <span class="fl">.75</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Class, <span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">".pred"</span>))</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">hard_pred_<span class="fl">0.75</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(<span class="dt">.truth =</span> Class, .pred)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;   .truth      .pred     n</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;   &lt;fct&gt;  &lt;clss_prd&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; 1 good         good  2788</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; 2 good          bad    18</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; 3 bad          good   151</span></a></code></pre></div>
<p>In this case, <code>5</code> of the bad loans were correctly classified as bad, but some of the good loans were also misclassified as bad now. There is a tradeoff here, which can be somewhat captured by the metrics <em>sensitivity</em> and <em>specificity</em>. Both metrics have a max value of <code>1</code>.</p>
<ul>
<li>sensitivity - The proportion of predicted “good” loans out of all “good” loans</li>
<li>specificity - The proportion of predicted “bad” loans out of all “bad” loans</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(yardstick)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; For binary classification, the first factor level is assumed to be the event.</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; Set the global option `yardstick.event_first` to `FALSE` to change this.</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co"># Currently yardstick can't deal with the class_pred objects that come from</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co"># probably, but it will be able to soon!</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">hard_pred_<span class="fl">0.5</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(hard_pred_<span class="fl">0.5</span>, <span class="dt">.pred =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/coercion-factor">as.factor</a></span>(.pred))</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">hard_pred_<span class="fl">0.75</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(hard_pred_<span class="fl">0.75</span>, <span class="dt">.pred =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/generics/topics/coercion-factor">as.factor</a></span>(.pred))</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/yardstick/topics/sens">sens</a></span>(hard_pred_<span class="fl">0.5</span>, Class, .pred)</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;   .metric .estimator .estimate</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; 1 sens    binary         0.999</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/yardstick/topics/spec">spec</a></span>(hard_pred_<span class="fl">0.5</span>, Class, .pred)</a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;   .metric .estimator .estimate</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; 1 spec    binary             0</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="kw"><a href="https://www.rdocumentation.org/packages/yardstick/topics/sens">sens</a></span>(hard_pred_<span class="fl">0.75</span>, Class, .pred)</a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt;   .metric .estimator .estimate</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="co">#&gt; 1 sens    binary         0.994</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="kw"><a href="https://www.rdocumentation.org/packages/yardstick/topics/spec">spec</a></span>(hard_pred_<span class="fl">0.75</span>, Class, .pred)</a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="co">#&gt;   .metric .estimator .estimate</span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="co">#&gt; 1 spec    binary             0</span></a></code></pre></div>
<p>In this example, as we increased specificity (by capturing those <code>5</code> bad loans with a higher threshold), we lowered sensitivity (by incorrectly reclassifying some of the good loans as bad). It would be nice to have some combination of these metrics to represent this tradeoff. Luckily, <code>j_index</code> is exactly that.</p>
<p><span class="math display">\[ j\_index = sens + spec - 1 \]</span></p>
<p><code>j_index</code> has a maximum value of 1 when there are no false positives and no false negatives. It can be used as justification of whether or not an increase in the threshold value is worth it. If increasing the threshold results in more of an increase in the specificity than a decrease in the sensitivity, we can see that with <code>j_index</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/yardstick/topics/j_index">j_index</a></span>(hard_pred_<span class="fl">0.5</span>, Class, .pred)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt;   .metric .estimator .estimate</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; 1 j_index binary     -0.000713</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/yardstick/topics/j_index">j_index</a></span>(hard_pred_<span class="fl">0.75</span>, Class, .pred)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt;   .metric .estimator .estimate</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; 1 j_index binary      -0.00641</span></a></code></pre></div>
<p>Now, this is not the only way to optimize things. If you care about low false positives, you might be more interested in keeping sensitivity high, and this wouldn’t be the best way to tackle this problem. But for now, let’s see how we can use probably to optimize the <code>j_index</code>.</p>
<p><code><a href="../reference/threshold_perf.html">threshold_perf()</a></code> will recalculate a number of metrics across varying thresholds. One of these is <code>j_index</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">threshold_data &lt;-<span class="st"> </span>lending_test_pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/threshold_perf.html">threshold_perf</a></span>(Class, .pred_good, <span class="dt">thresholds =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">0.0025</span>))</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">threshold_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(.threshold <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>))</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; # A tibble: 12 x 4</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;    .threshold .metric  .estimator .estimate</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;         &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;  1        0.5 sens     binary      0.999   </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;  2        0.6 sens     binary      0.999   </span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt;  3        0.7 sens     binary      0.994   </span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;  4        0.5 spec     binary      0       </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;  5        0.6 spec     binary      0       </span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;  6        0.7 spec     binary      0       </span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;  7        0.5 j_index  binary     -0.000713</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt;  8        0.6 j_index  binary     -0.000713</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt;  9        0.7 j_index  binary     -0.00570 </span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; 10        0.5 distance binary      1.00    </span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; 11        0.6 distance binary      1.00    </span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt; 12        0.7 distance binary      1.00</span></a></code></pre></div>
<p>With <code>ggplot2</code>, we can easily visualize this varying performance to find our optimal threshold for maximizing <code>j_index</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">threshold_data &lt;-<span class="st"> </span>threshold_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(.metric <span class="op">!=</span><span class="st"> "distance"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">group =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">    .metric <span class="op">==</span><span class="st"> "sens"</span> <span class="op">|</span><span class="st"> </span>.metric <span class="op">==</span><span class="st"> "spec"</span> <span class="op">~</span><span class="st"> "1"</span>,</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> "2"</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  ))</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">max_j_index_threshold &lt;-<span class="st"> </span>threshold_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(.metric <span class="op">==</span><span class="st"> "j_index"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(.estimate <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(.estimate)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(.threshold)</a>
<a class="sourceLine" id="cb11-14" data-line-number="14"></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(threshold_data, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> .threshold, <span class="dt">y =</span> .estimate, <span class="dt">color =</span> .metric, <span class="dt">alpha =</span> group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_minimal</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/scale_viridis">scale_color_viridis_d</a></span>(<span class="dt">end =</span> <span class="fl">0.9</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/scale_manual">scale_alpha_manual</a></span>(<span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(.<span class="dv">4</span>, <span class="dv">1</span>), <span class="dt">guide =</span> <span class="st">"none"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_abline">geom_vline</a></span>(<span class="dt">xintercept =</span> max_j_index_threshold, <span class="dt">alpha =</span> <span class="fl">.6</span>, <span class="dt">color =</span> <span class="st">"grey30"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(</a>
<a class="sourceLine" id="cb11-22" data-line-number="22">    <span class="dt">x =</span> <span class="st">"'Good' Threshold</span><span class="ch">\n</span><span class="st">(above this value is considered 'good')"</span>,</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">    <span class="dt">y =</span> <span class="st">"Metric Estimate"</span>,</a>
<a class="sourceLine" id="cb11-24" data-line-number="24">    <span class="dt">title =</span> <span class="st">"Balancing performance by varying the threshold"</span>,</a>
<a class="sourceLine" id="cb11-25" data-line-number="25">    <span class="dt">subtitle =</span> <span class="st">"Sensitivity or specificity alone might not be enough!</span><span class="ch">\n</span><span class="st">Vertical line = Max J-Index"</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26">  )</a></code></pre></div>
<p><img src="where-to-use_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
<p>It’s clear from this visual that the optimal threshold is very high, exactly 0.94. This is pretty high, so again, this optimization method won’t be useful for all cases. To wrap up, here are all of the test set metrics for that threshold value.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">threshold_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(.threshold <span class="op">==</span><span class="st"> </span>max_j_index_threshold)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 5</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt;   .threshold .metric .estimator .estimate group</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt;        &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; 1       0.94 sens    binary         0.699 1    </span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; 2       0.94 spec    binary         0.675 1    </span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; 3       0.94 j_index binary         0.374 2</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#example">Example</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="tidyverse">
  <p>probably is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn, Davis Vaughan.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>
      </footer>
</div>

  

  </body>
</html>
